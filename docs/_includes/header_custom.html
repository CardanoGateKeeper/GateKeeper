<button class="btn btn-outline" id="gk-theme-toggle" type="button"
        aria-label="Toggle dark mode">
    <span id="gk-theme-icon">🌙</span>
</button>

<script>
    (function () {
        const KEY = "gk-theme";
        const prefersDark = window.matchMedia("(prefers-color-scheme: dark)").matches;
        const saved = localStorage.getItem(KEY);
        const initial = saved || (prefersDark ? "gatekeeper-dark" : "gatekeeper");
        if (typeof jtd !== "undefined") jtd.setTheme(initial);
        document.addEventListener("DOMContentLoaded", function () {
            const btn = document.getElementById("gk-theme-toggle");
            const icon = document.getElementById("gk-theme-icon");

            function refreshIcon() {
                icon.textContent = (jtd.getTheme() === "gatekeeper-dark") ? "☀️" : "🌙";
            }

            refreshIcon();
            btn.addEventListener("click", function () {
                const next = (jtd.getTheme() === "gatekeeper-dark") ? "gatekeeper" : "gatekeeper-dark";
                jtd.setTheme(next);
                localStorage.setItem(KEY, next);
                refreshIcon();
            });
        });
    })();
</script>